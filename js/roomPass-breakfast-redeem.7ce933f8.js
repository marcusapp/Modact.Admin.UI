"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[7869],{32501:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}});var s=a(66252),o=a(3577),r=a(49963);const i=e=>((0,s.dD)("data-v-0d523c74"),e=e(),(0,s.Cn)(),e),n={class:"left-panel"},d={class:"card-item"},l=i((()=>(0,s._)("br",null,null,-1))),u=i((()=>(0,s._)("br",null,null,-1))),m={class:"card-item"},c=i((()=>(0,s._)("br",null,null,-1))),h=i((()=>(0,s._)("br",null,null,-1))),_={class:"right-panel"},p={class:"right-panel-search"},w={style:{"font-size":"large"}};function k(e,t,a,i,k,f){const b=(0,s.up)("el-icon-user-filled"),g=(0,s.up)("el-icon"),y=(0,s.up)("el-card"),$=(0,s.up)("el-date-picker"),R=(0,s.up)("el-link"),C=(0,s.up)("el-button"),T=(0,s.up)("el-tooltip"),O=(0,s.up)("el-input"),v=(0,s.up)("el-badge"),D=(0,s.up)("el-header"),S=(0,s.up)("el-table-column"),P=(0,s.up)("el-text"),A=(0,s.up)("el-popconfirm"),H=(0,s.up)("el-tag"),I=(0,s.up)("el-button-group"),W=(0,s.up)("scTable"),N=(0,s.up)("el-main"),E=(0,s.up)("el-container"),Y=(0,s.up)("save-dialog");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(E,null,{default:(0,s.w5)((()=>[(0,s.Wm)(D,{style:{"min-height":"160px"}},{default:(0,s.w5)((()=>[(0,s._)("div",n,[(0,s.Wm)(y,{shadow:"always",header:""},{default:(0,s.w5)((()=>[(0,s._)("div",d,[(0,s._)("h1",null,[(0,s.Wm)(g,{style:{"margin-right":"6px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1}),(0,s.Uk)((0,o.zw)(k.summary.todayTotalHeadCount-k.summary.todayRedeemedHeadCount),1)]),(0,s._)("p",null,[(0,s.Uk)((0,o.zw)(e.$t("roomPass_breakfast_redeem.todayRedeemed"))+": "+(0,o.zw)(k.summary.todayRedeemedHeadCount),1),l,(0,s.Uk)(" "+(0,o.zw)(e.$t("roomPass_breakfast_redeem.todayTotal"))+": "+(0,o.zw)(k.summary.todayTotalHeadCount),1),u,(0,s.Uk)(" ✧✧✧✧✧✧ ")])])])),_:1}),(0,s.Wm)(y,{shadow:"always",header:"",class:(0,o.C_)({"card-active":""!==this.current.room_no&&k.summary.roomRedeemedHeadCount<k.current.package_head_count,"card-inactive":""!==this.current.room_no&&!(k.summary.roomRedeemedHeadCount<k.current.package_head_count)})},{default:(0,s.w5)((()=>[(0,s._)("div",m,[(0,s._)("h1",null,[(0,s.Wm)(g,{style:{"margin-right":"6px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(b)])),_:1}),(0,s.Uk)((0,o.zw)(k.current.package_head_count-k.summary.roomRedeemedHeadCount),1)]),(0,s._)("p",null,[(0,s.Uk)((0,o.zw)(e.$t("roomPass_breakfast_redeem.roomRedeemed"))+": "+(0,o.zw)(k.summary.roomRedeemedHeadCount),1),c,(0,s.Uk)(" "+(0,o.zw)(e.$t("roomPass_breakfast_redeem.roomTotal"))+": "+(0,o.zw)(k.current.package_head_count),1),h,(0,s.Uk)(" "+(0,o.zw)(e.$t("roomPass_breakfast_redeem.roomSource"))+": "+(0,o.zw)(k.current.package_room_source_id),1)])])])),_:1},8,["class"])]),(0,s._)("div",_,[(0,s._)("div",p,[(0,s.Wm)($,{modelValue:k.current.business_date,"onUpdate:modelValue":t[0]||(t[0]=e=>k.current.business_date=e),type:"date",placeholder:e.$t("common.date"),onKeyup:(0,r.D2)(f.upsearch,["enter"]),"value-format":"YYYY-MM-DD",style:{width:"120px"},disabled:""},null,8,["modelValue","placeholder","onKeyup"]),(0,s.Wm)(O,{modelValue:k.search.keyword,"onUpdate:modelValue":t[1]||(t[1]=e=>k.search.keyword=e),placeholder:e.$t("roomPass_breakfast_redeem.roomSearch"),maxlength:"4",onKeyup:(0,r.D2)(f.upsearch,["enter"]),ref:"search_input",style:{width:"190px"}},{prepend:(0,s.w5)((()=>[(0,s.Wm)(R,{type:"primary",underline:!1,style:{width:"25px","font-size":"large"},class:(0,o.C_)({"text-room-active":""!==this.current.room_no&&k.summary.roomRedeemedHeadCount<k.current.package_head_count,"text-room-inactive":""!==this.current.room_no&&!(k.summary.roomRedeemedHeadCount<k.current.package_head_count)})},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(k.current.room_no),1)])),_:1},8,["class"])])),append:(0,s.w5)((()=>[(0,s.Wm)(T,{content:e.$t("common.search"),placement:"top",effect:"light"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{type:"primary",icon:"el-icon-search",onClick:f.upsearch},null,8,["onClick"])])),_:1},8,["content"])])),_:1},8,["modelValue","placeholder","onKeyup"]),(0,s.Wm)(v,{value:k.current.package_head_count-k.summary.roomRedeemedHeadCount,class:"item",hidden:k.current.package_head_count-k.summary.roomRedeemedHeadCount<=0},{default:(0,s.w5)((()=>[this.$AUTH("RPS/BreakfastRedeem/Add")?((0,s.wg)(),(0,s.j4)(C,{key:0,type:"primary",icon:"el-icon-plus",style:{"min-width":"60px","min-height":"80px"},onClick:f.add,disabled:null==this.current.room_no||""==this.current.room_no||this.current.head_count_max<=0},null,8,["onClick","disabled"])):(0,s.kq)("",!0)])),_:1},8,["value","hidden"]),(0,s.Wm)(C,{type:"success",plain:"",icon:"el-icon-postcard",style:{"min-width":"150px","min-height":"80px"},onClick:f.getRoomCardInfo},{default:(0,s.w5)((()=>[(0,s._)("span",w,(0,o.zw)(e.$t("roomPass_breakfast_redeem.roomCardRead")),1)])),_:1},8,["onClick"]),(0,s.Wm)(T,{content:e.$t("common.reset"),placement:"top",effect:"light"},{default:(0,s.w5)((()=>[(0,s.Wm)(C,{type:"warning",icon:"el-icon-refresh-left",onClick:f.reset,style:{width:"30px"},plain:""},null,8,["onClick"])])),_:1},8,["content"])])])])),_:1}),(0,s.Wm)(N,{class:"nopadding"},{default:(0,s.w5)((()=>[(0,s.Wm)(W,{ref:"table",apiObj:k.apiObj,params:{...k.apiObjParams},"row-key":"id",onSelectionChange:f.selectionChange,"scrollbar-always-on":"",border:"",size:"small"},{default:(0,s.w5)((()=>[(0,s.Wm)(S,{type:"selection",width:"50"}),(0,s.Wm)(S,{label:"#",type:"index",width:"50"}),(0,s.kq)("",!0),(0,s.kq)("",!0),(0,s.kq)("",!0),(0,s.kq)("",!0),(0,s.Wm)(S,{label:e.$t("roomPass_breakfast_redeem.roomNo"),prop:"room_no",width:"60"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("roomPass_breakfast_redeem.roomSource"),prop:"room_source_id",width:"60"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("roomPass_breakfast_redeem.headCount"),prop:"head_count",width:"60"},null,8,["label"]),(0,s.kq)("",!0),(0,s.Wm)(S,{label:e.$t("roomPass_breakfast_redeem.posCheckNo"),prop:"pos_check_no",width:"100"},{default:(0,s.w5)((t=>[null!=t.row.pos_check_no?((0,s.wg)(),(0,s.j4)(P,{key:0},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(t.row.pos_check_no),1)])),_:2},1024)):(0,s.kq)("",!0),null==t.row.pos_check_no&&this.$AUTH("RPS/BreakfastRedeem/Void")&&!t.row.is_void?((0,s.wg)(),(0,s.j4)(A,{key:1,title:e.$t("roomPass_breakfast_redeem.confirmSendToPOS"),onConfirm:e=>f.sendToPOS(t.row,t.$index)},{reference:(0,s.w5)((()=>[(0,s.Wm)(C,{type:"warning",size:"small",plain:"",loading:k.isSendingToPOS},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.$t("roomPass_breakfast_redeem.sendToPOS")),1)])),_:1},8,["loading"])])),_:2},1032,["title","onConfirm"])):(0,s.kq)("",!0)])),_:1},8,["label"]),(0,s.Wm)(S,{label:e.$t("common.status"),prop:"is_void",width:"80"},{default:(0,s.w5)((t=>[t.row.is_void?(0,s.kq)("",!0):((0,s.wg)(),(0,s.j4)(H,{key:0,type:"success",round:""},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.$t("common.active")),1)])),_:1})),t.row.is_void?((0,s.wg)(),(0,s.j4)(H,{key:1,type:"danger",round:""},{default:(0,s.w5)((()=>[(0,s.Uk)((0,o.zw)(e.$t("common.void")),1)])),_:1})):(0,s.kq)("",!0)])),_:1},8,["label"]),(0,s.Wm)(S,{label:e.$t("common.remark"),prop:"remark","min-width":"150"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("common.createTime"),prop:"create_time",width:"180"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("common.createUser"),prop:"create_user_id",width:"180"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("common.modifyTime"),prop:"modify_time",width:"180"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("common.modifyUser"),width:"180"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("common.voidTime"),prop:"void_switch_time",width:"180"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("common.voidUser"),prop:"void_switch_user_id",width:"180"},null,8,["label"]),(0,s.Wm)(S,{label:e.$t("common.operate"),fixed:"right",align:"right",width:"130"},{default:(0,s.w5)((t=>[(0,s.Wm)(I,null,{default:(0,s.w5)((()=>[(0,s.Wm)(C,{plain:"",icon:"el-icon-search",onClick:e=>f.table_show(t.row,t.$index)},null,8,["onClick"]),!1===t.row.is_void&&this.$AUTH("RPS/BreakfastRedeem/Void")&&""!=this.current.room_no?((0,s.wg)(),(0,s.j4)(A,{key:0,title:e.$t("common.confirmVoid"),onConfirm:e=>f.table_void(t.row,t.$index)},{reference:(0,s.w5)((()=>[(0,s.Wm)(C,{plain:"",type:"danger",icon:"el-icon-circle-close"})])),_:2},1032,["title","onConfirm"])):(0,s.kq)("",!0)])),_:2},1024)])),_:1},8,["label"])])),_:1},8,["apiObj","params","onSelectionChange"])])),_:1})])),_:1}),k.dialog.save?((0,s.wg)(),(0,s.j4)(Y,{key:0,ref:"saveDialog",onSuccess:f.handleSaveSuccess,onClosed:t[2]||(t[2]=e=>k.dialog.save=!1)},null,8,["onSuccess"])):(0,s.kq)("",!0)],64)}var f=a(9261),b=a(27484),g={name:"breakfast/redeem",components:{saveDialog:f["default"]},data(){return{dialog:{save:!1,permission:!1},apiObj:this.$API.rps_breakfast.redeem.list,apiObjParams:{orderBy:"create_time desc",whereConditions:{},whereQuery:"WHERE business_date = CONVERT(DATE, '"+b(this.$TOOL.data.get("APP_TIME")).format("YYYY-MM-DD")+"',120) AND bu_id_restaurant='"+this.$CONFIG.MY_RESTAURANT_ID+"' AND bu_id_hotel='"+this.$CONFIG.MY_HOTEL_ID+"'"},selection:[],search:{keyword:""},current:{bu_id_restaurant:this.$CONFIG.MY_RESTAURANT_ID,bu_id_hotel:this.$CONFIG.MY_HOTEL_ID,room_no:"",business_date:b(this.$TOOL.data.get("APP_TIME")).format("YYYY-MM-DD"),head_count:1,head_count_max:0,amount:0,package_id:"",package_room_source_id:"",package_amount:0,package_head_count:0},summary:{todayRedeemedRoom:0,todayTotalRoom:0,todayRedeemedHeadCount:0,todayTotalHeadCount:0,roomRedeemedHeadCount:0},isSendingToPOS:!1}},mounted(){this.getSummary()},methods:{reset(){this.current.bu_id_restaurant=this.$CONFIG.MY_RESTAURANT_ID,this.current.bu_id_hotel=this.$CONFIG.MY_HOTEL_ID,this.current.room_no="",this.current.business_date=b(this.$TOOL.data.get("APP_TIME")).format("YYYY-MM-DD"),this.current.amount=0,this.current.package_id="",this.current.package_room_source_id="",this.current.package_amount=0,this.current.package_head_count=0,this.summary.roomRedeemedHeadCount=0,this.apiObjParams.whereConditions={},this.apiObjParams.whereQuery="WHERE business_date = CONVERT(DATE, '"+this.current.business_date+"',120) AND bu_id_restaurant='"+this.$CONFIG.MY_RESTAURANT_ID+"' AND bu_id_hotel='"+this.$CONFIG.MY_HOTEL_ID+"'",this.getSummary(),this.search.keyword="",this.$refs.table.reload({...this.apiObjParams})},add(){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open().setData(this.current)}))},table_edit(e){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("edit").setData(e)}))},table_show(e){this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("show").setData(e)}))},async table_void(e){var t=await this.$API.rps_breakfast.redeem.void.post(e);1==t.Results.default.Success&&(this.$refs.table.refresh(),this.$message.success(this.$t("common.successVoid"))),this.getSummary()},async table_voidundo(e){var t=await this.$API.rps_breakfast.redeem.voidundo.post(e);1==t.Results.default.Success&&(this.$refs.table.refresh(),this.$message.success(this.$t("common.successVoidUndo"))),this.getSummary()},async batch_void(){this.$alert(this.$t("common.msgFunctionNotAvailable"),this.$t("common.hint"),{type:"error"})},selectionChange(e){this.selection=e},changeSwitch(e,t){t.status="1"==t.status?"0":"1",t.$switch_status=!0,setTimeout((()=>{delete t.$switch_status,t.status=e,this.$message.success(this.$t("common.successOperate"))}),500)},upsearch(){if(null!=this.search.keyword&&""!=this.search.keyword){if(this.search.keyword===this.current.room_no)return this.search.keyword="",void this.$refs.search_input.focus();this.current.room_no=this.search.keyword,this.apiObjParams.whereQuery="WHERE business_date = CONVERT(DATE, '"+this.current.business_date+"',120)  AND (room_no = '"+this.current.room_no+"' OR '' = '"+this.current.room_no+"') AND bu_id_restaurant='"+this.$CONFIG.MY_RESTAURANT_ID+"' AND bu_id_hotel='"+this.$CONFIG.MY_HOTEL_ID+"'",this.getSummary(),this.getPackageId(),this.current.head_count_max=this.current.package_head_count-this.summary.roomRedeemedHeadCount,this.search.keyword="",this.$refs.search_input.focus(),this.$refs.table.upData({...this.apiObjParams})}else this.reset()},filterTree(e){var t=null;function a(s){s.forEach((s=>{s.id==e&&(t=s),s.children&&a(s.children)}))}return a(this.$refs.table.tableData),t},handleSaveSuccess(e,t){("add"==t||"edit"==t)&&this.$refs.table.refresh(),this.getSummary()},getRoomCardInfo(){window.chrome?.webview?.hostObjects?.customHost||this.$message.warning(this.$t("roomPass_breakfast_redeem.msgClientModeOnly")),window.chrome?.webview?.hostObjects?.customHost?.GetRoomInfo().then((e=>{e=JSON.parse(e);const t=b(e.checkInTime).startOf("day"),a=b(e.checkOutTime).startOf("day"),o=b(this.current.business_date);a<o||t>o?this.$alert((0,s.h)("table",null,[(0,s.h)("tr",null,[(0,s.h)("td",null,"Room:  "),(0,s.h)("td",null,e.roomNo)]),(0,s.h)("tr",null,[(0,s.h)("td",null,"Card Begin:  "),(0,s.h)("td",null,e.checkInTime)]),(0,s.h)("tr",null,[(0,s.h)("td",null,"Card End:  "),(0,s.h)("td",null,e.checkOutTime)])]),this.$t("roomPass_breakfast_redeem.msgRoomCardExpired"),{type:"error"}):(this.search.keyword=e.roomNo,this.upsearch())}))},async getSummary(){let e=await this.$API.rps_breakfast.redeem.summary.get(this.current);if(e&&e.Results&&e.Results.default&&1==e.Results.default.Success&&e.Results.default.Data[0]){const t=e.Results.default.Data[0];this.summary.todayTotalRoom=t.dateTotalRoom,this.summary.todayRedeemedRoom=t.dateRedeemedRoom,this.summary.todayTotalHeadCount=t.dateTotalHeadCount,this.summary.todayRedeemedHeadCount=t.dateRedeemedHeadCount,this.summary.roomRedeemedHeadCount=t.roomRedeemedHeadCount,this.current.head_count_max=this.current.package_head_count-this.summary.roomRedeemedHeadCount}},async getPackageId(){if(null==this.current.room_no||""==this.current.room_no)return;const e={page:1,pageSize:10,orderBy:"id DESC",whereConditions:{},whereQuery:"WHERE is_void=0 AND business_date = CONVERT(DATE, '"+b(this.$TOOL.data.get("APP_TIME")).format("YYYY-MM-DD")+"',120) AND bu_id_restaurant='"+this.$CONFIG.MY_RESTAURANT_ID+"' AND bu_id_hotel='"+this.$CONFIG.MY_HOTEL_ID+"' AND room_no = '"+this.current.room_no+"'"};let t=await this.$API.rps_breakfast.package.list.get(e);if(t&&t.Results&&t.Results.default&&1==t.Results.default.Success&&t.Results.default.Data?.DataRows){const e=t.Results.default.Data?.DataRows;if(null!=e&&null!=e[0])return this.current.package_id=e[0].id,this.current.package_room_source_id=e[0].room_source_id,this.current.package_amount=e[0].amount,this.current.package_head_count=e[0].head_count,void(this.current.head_count_max=this.current.package_head_count-this.summary.roomRedeemedHeadCount)}this.current.package_id="",this.current.package_room_source_id="",this.current.package_amount=0,this.current.package_head_count=0,this.current.head_count_max=this.current.package_head_count-this.summary.roomRedeemedHeadCount},async sendToPOS(e){this.isSendingToPOS=!0;var t=await this.$API.rps_breakfast.roomSourcePOS.sendToPOS.post(e);1==t.Results.default.Success&&(this.$refs.table.refresh(),this.$message.success(this.$t("common.successOperate"))),this.isSendingToPOS=!1,this.getSummary()}}},y=a(83744);const $=(0,y.Z)(g,[["render",k],["__scopeId","data-v-0d523c74"]]);var R=$}}]);