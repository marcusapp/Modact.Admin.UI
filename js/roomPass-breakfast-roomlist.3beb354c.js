"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[6587],{79852:function(e,a,t){t.r(a),t.d(a,{default:function(){return f}});var o=t(66252),s=t(3577);const r=e=>((0,o.dD)("data-v-b20e756c"),e=e(),(0,o.Cn)(),e),l={class:"left-panel"},i={class:"card-item"},m=r((()=>(0,o._)("br",null,null,-1))),d=r((()=>(0,o._)("br",null,null,-1))),u={class:"card-item"},n=r((()=>(0,o._)("br",null,null,-1))),h={class:"right-panel"},_={class:"right-panel-search"};function b(e,a,t,r,b,c){const y=(0,o.up)("el-icon-user-filled"),p=(0,o.up)("el-icon"),k=(0,o.up)("el-card"),f=(0,o.up)("el-icon-school"),w=(0,o.up)("el-date-picker"),C=(0,o.up)("el-option"),R=(0,o.up)("el-select"),O=(0,o.up)("el-button"),T=(0,o.up)("el-header"),P=(0,o.up)("el-table-column"),D=(0,o.up)("el-tag"),$=(0,o.up)("scTable"),N=(0,o.up)("el-main"),A=(0,o.up)("el-container");return(0,o.wg)(),(0,o.j4)(A,null,{default:(0,o.w5)((()=>[(0,o.Wm)(T,{style:{"min-height":"140px"}},{default:(0,o.w5)((()=>[(0,o._)("div",l,[(0,o.Wm)(k,{shadow:"always",header:""},{default:(0,o.w5)((()=>[(0,o._)("div",i,[(0,o._)("h1",null,[(0,o.Wm)(p,{style:{"margin-right":"6px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(y)])),_:1}),(0,o.Uk)((0,s.zw)(b.summary.todayTotalHeadCount-b.summary.todayRedeemedHeadCount),1)]),(0,o._)("p",null,[(0,o.Uk)((0,s.zw)(e.$t("roomPass_breakfast_roomlist.todayRedeemed"))+": "+(0,s.zw)(b.summary.todayRedeemedHeadCount),1),m,(0,o.Uk)((0,s.zw)(e.$t("roomPass_breakfast_roomlist.todayTotal"))+": "+(0,s.zw)(b.summary.todayTotalHeadCount),1),d])])])),_:1}),(0,o.Wm)(k,{shadow:"always",header:""},{default:(0,o.w5)((()=>[(0,o._)("div",u,[(0,o._)("h1",null,[(0,o.Wm)(p,{style:{"margin-right":"6px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(f)])),_:1}),(0,o.Uk)((0,s.zw)(b.summary.todayTotalRoom-b.summary.todayRedeemedRoom),1)]),(0,o._)("p",null,[(0,o.Uk)((0,s.zw)(e.$t("roomPass_breakfast_roomlist.todayRedeemedRoom"))+": "+(0,s.zw)(b.summary.todayRedeemedRoom),1),n,(0,o.Uk)((0,s.zw)(e.$t("roomPass_breakfast_roomlist.todayTotalRoom"))+": "+(0,s.zw)(b.summary.todayTotalRoom),1)])])])),_:1})]),(0,o._)("div",h,[(0,o._)("div",_,[(0,o._)("div",null,[(0,o.Uk)((0,s.zw)(e.$t("common.filter"))+": ",1),(0,o.Wm)(w,{modelValue:b.current.business_date,"onUpdate:modelValue":a[0]||(a[0]=e=>b.current.business_date=e),type:"date",placeholder:e.$t("roomPass_breakfast_roomlist.businessDate"),"value-format":"YYYY-MM-DD",onChange:c.filterConditionChange,style:{width:"120px"}},null,8,["modelValue","placeholder","onChange"]),(0,o.Wm)(R,{modelValue:b.roomlistFilter,"onUpdate:modelValue":a[1]||(a[1]=e=>b.roomlistFilter=e),"value-key":"roomlistFilter",style:{width:"100px"},onChange:c.filterConditionChange},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(b.roomlistFilterSelect,(e=>((0,o.wg)(),(0,o.j4)(C,{key:e.key,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])]),(0,o.Wm)(O,{type:"primary",icon:"el-icon-search",onClick:c.upsearch,style:{"min-width":"60px","min-height":"80px"},plain:""},null,8,["onClick"]),(0,o.Wm)(O,{type:"warning",icon:"el-icon-refresh-left",onClick:c.reset,style:{width:"30px"},plain:""},null,8,["onClick"])])])])),_:1}),(0,o.Wm)(N,{class:"nopadding"},{default:(0,o.w5)((()=>[(0,o.Wm)($,{ref:"table",apiObj:b.apiObj,params:{...b.apiObjParams},"row-key":"id","scrollbar-always-on":"",border:"",size:"small",remoteSort:""},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{type:"selection",width:"50"}),(0,o.Wm)(P,{label:"#",type:"index",width:"50"}),(0,o.kq)("",!0),(0,o.kq)("",!0),(0,o.kq)("",!0),(0,o.Wm)(P,{label:e.$t("roomPass_breakfast_roomlist.businessDate"),prop:"business_date",width:"100"},null,8,["label"]),(0,o.Wm)(P,{label:e.$t("roomPass_breakfast_roomlist.roomNo"),prop:"room_no",width:"80",sortable:""},null,8,["label"]),(0,o.Wm)(P,{label:e.$t("roomPass_breakfast_roomlist.roomSource"),prop:"room_source_id",width:"90",sortable:""},null,8,["label"]),(0,o.Wm)(P,{label:e.$t("roomPass_breakfast_roomlist.headCountTotal"),prop:"head_count",width:"90",sortable:""},null,8,["label"]),(0,o.Wm)(P,{label:e.$t("roomPass_breakfast_roomlist.redeemed"),prop:"head_count_redeemed",width:"90",sortable:""},{default:(0,o.w5)((e=>[(0,o.Wm)(D,{type:"warning",round:""},{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.row.head_count_redeemed),1)])),_:2},1024)])),_:1},8,["label"]),(0,o.Wm)(P,{label:e.$t("roomPass_breakfast_roomlist.remainAvailable"),prop:"head_count_remain",width:"90",sortable:""},null,8,["label"]),(0,o.Wm)(P,{label:e.$t("roomPass_breakfast_roomlist.posCheckNo"),prop:"pos_check_no","min-width":"150"},null,8,["label"]),(0,o.kq)("",!0),(0,o.kq)("",!0),(0,o.kq)("",!0),(0,o.kq)("",!0)])),_:1},8,["apiObj","params"])])),_:1})])),_:1})}var c=t(27484),y={name:"breakfast/roomlist",components:{},data(){return{apiObj:this.$API.rps_breakfast.redeem.roomlist,apiObjParams:{orderBy:"room_no",whereConditions:{},whereQuery:"WHERE business_date = CONVERT(DATE, '"+c(this.$TOOL.data.get("APP_TIME")).format("YYYY-MM-DD")+"',120) AND bu_id_restaurant='"+this.$CONFIG.MY_RESTAURANT_ID+"' AND bu_id_hotel='"+this.$CONFIG.MY_HOTEL_ID+"'"},selection:[],search:{keyword:""},current:{bu_id_restaurant:this.$CONFIG.MY_RESTAURANT_ID,bu_id_hotel:this.$CONFIG.MY_HOTEL_ID,room_no:"",business_date:c(this.$TOOL.data.get("APP_TIME")).format("YYYY-MM-DD"),head_count:1,head_count_max:0,amount:0},summary:{todayRedeemedRoom:0,todayTotalRoom:0,todayRedeemedHeadCount:0,todayTotalHeadCount:0,roomRedeemedHeadCount:0,roomTotalHeadCount:0},roomlistFilter:0,roomlistFilterSelect:[{key:0,label:this.$t("roomPass_breakfast_roomlist.filterRoomAll"),value:0},{key:1,label:this.$t("roomPass_breakfast_roomlist.filterRoomNot"),value:1},{key:2,label:this.$t("roomPass_breakfast_roomlist.filterRoomSome"),value:2},{key:3,label:this.$t("roomPass_breakfast_roomlist.filterRoomFinish"),value:3}],orderbyItem:0,orderbyItemSelect:[{key:0,label:this.$t("roomPass_breakfast_roomlist.roomNo"),value:0},{key:1,label:this.$t("roomPass_breakfast_roomlist.headCount"),value:1},{key:2,label:this.$t("roomPass_breakfast_roomlist.redeemed"),value:2},{key:3,label:this.$t("roomPass_breakfast_roomlist.remainAvailable"),value:3}],orderbySeq:0,orderbySeqSelect:[{key:0,label:this.$t("common.orderASC"),value:0},{key:1,label:this.$t("common.orderDESC"),value:1}]}},mounted(){this.apiObjParams.whereQuery="WHERE business_date = CONVERT(DATE, '"+this.current.business_date+"',120) AND bu_id_restaurant='"+this.$CONFIG.MY_RESTAURANT_ID+"' AND bu_id_hotel='"+this.$CONFIG.MY_HOTEL_ID+"'",this.getSummary()},methods:{reset(){this.current.bu_id_restaurant=this.$CONFIG.MY_RESTAURANT_ID,this.current.bu_id_hotel=this.$CONFIG.MY_HOTEL_ID,this.current.room_no="",this.current.business_date=c(this.$TOOL.data.get("APP_TIME")).format("YYYY-MM-DD"),this.current.amount=0,this.summary.roomRedeemedHeadCount=0,this.summary.roomTotalHeadCount=0,this.apiObjParams.orderBy="room_no",this.apiObjParams.whereConditions={},this.apiObjParams.whereQuery="WHERE business_date = CONVERT(DATE, '"+this.current.business_date+"',120) AND bu_id_restaurant='"+this.$CONFIG.MY_RESTAURANT_ID+"' AND bu_id_hotel='"+this.$CONFIG.MY_HOTEL_ID+"'",this.roomlistFilter=0,this.orderbyItem=0,this.orderbySeq=0,this.getSummary(),this.search.keyword="",this.$refs.table.reload({...this.apiObjParams})},upsearch(){null!=this.current.business_date&&""!=this.current.business_date?(this.getSummary(),this.$refs.table.upData({...this.apiObjParams})):this.$message.warning("請選擇日期.")},filterConditionChange(){const e="WHERE business_date = CONVERT(DATE, '"+this.current.business_date+"',120) AND bu_id_restaurant='"+this.$CONFIG.MY_RESTAURANT_ID+"' AND bu_id_hotel='"+this.$CONFIG.MY_HOTEL_ID+"'";switch(this.roomlistFilter){case 0:this.apiObjParams.whereQuery=e;break;case 1:this.apiObjParams.whereQuery=e+" AND head_count_redeemed=0";break;case 2:this.apiObjParams.whereQuery=e+" AND (head_count_redeemed>0 AND head_count_remain>0)";break;case 3:this.apiObjParams.whereQuery=e+" AND head_count_remain<=0";break;default:this.apiObjParams.whereQuery=e}switch(this.orderbyItem){case 0:this.apiObjParams.orderBy="room_no";break;case 1:this.apiObjParams.orderBy="head_count";break;case 2:this.apiObjParams.orderBy="head_count_redeemed";break;case 3:this.apiObjParams.orderBy="head_count_remain";break;default:this.apiObjParams.whereQuery="room_no"}switch(this.orderbySeq){case 1:this.apiObjParams.orderBy+=" DESC";break}},filterTree(e){var a=null;function t(o){o.forEach((o=>{o.id==e&&(a=o),o.children&&t(o.children)}))}return t(this.$refs.table.tableData),a},async getSummary(){var e=await this.$API.rps_breakfast.redeem.summary.get(this.current);if(e&&e.Results&&e.Results.default&&1==e.Results.default.Success&&e.Results.default.Data[0]){const a=e.Results.default.Data[0];this.summary.todayTotalRoom=a.dateTotalRoom,this.summary.todayRedeemedRoom=a.dateRedeemedRoom,this.summary.todayTotalHeadCount=a.dateTotalHeadCount,this.summary.todayRedeemedHeadCount=a.dateRedeemedHeadCount,this.summary.roomTotalHeadCount=a.roomTotalHeadCount,this.summary.roomRedeemedHeadCount=a.roomRedeemedHeadCount}}}},p=t(83744);const k=(0,p.Z)(y,[["render",b],["__scopeId","data-v-b20e756c"]]);var f=k}}]);