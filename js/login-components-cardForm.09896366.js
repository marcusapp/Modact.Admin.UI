"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[4850],{54971:function(e,r,s){s.r(r),s.d(r,{default:function(){return n}});var t=s(66252),i=s(49963);function o(e,r,s,o,a,l){const u=(0,t.up)("el-input"),n=(0,t.up)("el-form-item"),c=(0,t.up)("el-form");return(0,t.wg)(),(0,t.j4)(c,{ref:"loginForm",model:a.form,rules:a.rules,"label-width":"0",size:"large",onKeyup:(0,i.D2)(l.login,["enter"]),onClick:l.clickInput},{default:(0,t.w5)((()=>[(0,t.wy)((0,t.Wm)(n,{prop:"user"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{modelValue:a.form.user,"onUpdate:modelValue":r[0]||(r[0]=e=>a.form.user=e),"prefix-icon":"el-icon-user",clearable:"",placeholder:e.$t("login.userPlaceholder")},null,8,["modelValue","placeholder"])])),_:1},512),[[i.F8,!1]]),(0,t.Wm)(n,{prop:"cardkey"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{ref:"inputCardKey",modelValue:a.form.cardkey,"onUpdate:modelValue":r[1]||(r[1]=e=>a.form.cardkey=e),"prefix-icon":"el-icon-lock",clearable:"","show-password":"",placeholder:e.$t("login.CardPlaceholder")},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["model","rules","onKeyup","onClick"])}var a={data(){return{userType:"user",form:{user:"",cardkey:"",autologin:!1},rules:{cardkey:[{required:!0,message:this.$t("login.CardError"),trigger:"blur"}]},islogin:!1}},watch:{},mounted(){this.$refs.inputCardKey.focus()},methods:{async login(){var e=await this.$refs.loginForm.validate().catch((()=>{}));if(!e)return!1;if(null==this.form.cardkey||""==this.form.cardkey.trim())return!1;this.islogin=!0;var r={RequestId:"",RequestTime:new Date,Functions:[{Id:"Login",Fun:"AC/Auth/NewTokenByCardKey",Params:{cardkey:this.form.cardkey,gateId:"ACGPOS"}}]},s=await this.$API.auth.token.post(r);if(!s.Results.Login.Success)return this.islogin=!1,!1;{const e=s.Results.Login.Data.Access,r=s.Results.Login.Data.Refresh;this.$TOOL.data.set("TOKEN",e),this.$TOOL.data.set("TOKEN_REFRESH",r),this.$TOOL.cookie.set("TOKEN",e,{expires:this.form.autologin?86400:0});const t=e.split("."),i=t[1],o=JSON.parse(this.$TOOL.crypto.BASE64.decrypt(i)),a=o["obj"],l=JSON.parse(a),u={userId:l.UserId,userName:l.UserName,loginName:this.form.user,userGroup:l.UserGroup,dashboard:"0",role:"",ip:l.IP};if(this.$TOOL.data.set("USER_INFO",u),this.$TOOL.data.set("AUTO_EXIT",this.$CONFIG.AUTO_LOGOUT_MINUTE),await this.getUserPermission(),!this.$AUTH("RPS.UI.Access"))return this.islogin=!1,this.$alert("No permission [RPS.UI.Access]","用户沒有存取權限",{type:"error",center:!0}),!1}this.$router.replace({path:"/"}),this.islogin=!1},async getUserPermission(){var e=await this.$API.auth.session.get();e?.UserPermission&&this.$TOOL.data.set("PERMISSIONS",e.UserPermission)},clickInput(){this.$refs.inputCardKey.focus()}}},l=s(83744);const u=(0,l.Z)(a,[["render",o]]);var n=u}}]);